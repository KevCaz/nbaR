<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calibrating molecular phylogeny of the sharks • nbaR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Calibrating molecular phylogeny of the sharks">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nbaR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/nbaR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sharks.html">Calibrating molecular phylogeny of the sharks</a>
    </li>
    <li>
      <a href="../articles/tomato.html">The oldest tomato specimen in the world</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/naturalis/nbaR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Calibrating molecular phylogeny of the sharks</h1>
                        <h4 class="author">Hannes Hettling, Rutger Vos</h4>
            
            <h4 class="date">Aug 29, 2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/naturalis/nbaR/blob/master/vignettes/sharks.Rmd"><code>vignettes/sharks.Rmd</code></a></small>
      <div class="hidden name"><code>sharks.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>The time-calibration of molecular phylogenies, i.e. assigning absolute ages to nodes in the phylogeny is an essential tool in phylogenetic comparative analyses. Time-calibration can be accomplished with e.g. data from fossil specimen with an assigned age that are in a known taxonomic group. Specimen ages can be determined by e.g. carbon dating or stratigraphic methods. Node can then be assigned using Baeysian or Maximum-Likelihood methods. At Naturalis, quite a few of our specimen records hold chronographic information.</p>
<p>Here we will demonstrate how to extract this data using <code>nbaR</code> and how to create input for the popular tree-calibration function <code>chronos</code> from the phylogenetic analysis package <code>ape</code>.</p>
<div id="the-phylogeny" class="section level2">
<h2 class="hasAnchor">
<a href="#the-phylogeny" class="anchor"></a>The phylogeny</h2>
<p>As input, we will use a species-level molecular shark phylogeny published by <span class="citation">(Vélez-Zuazo and Agnarsson (2012) Vélez-Zuazo and Agnarsson 2011)</span>.</p>
<p>The phylogeny is a majority-rule consensus tree inferred from molecular markers using Bayesian inference and comprises 229 species in all eight orders of the sharks (superorder <em>Selachimorpha</em>):</p>
<p><img src="https://ars.els-cdn.com/content/image/1-s2.0-S1055790310004537-gr3.jpg"></p>
<p>The non-ultrametric tree in the above figure is not time-calibrated, the branch lengths thus represent molecular distances.</p>
</div>
</div>
<div id="getting-chronological-data-with-nbar" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-chronological-data-with-nbar" class="anchor"></a>Getting chronological data with nbaR</h1>
<p>Chronological association is associated with <code>Specimen</code> data, we thus instanciate a <code>SpecimenClient</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(nbaR)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">sc &lt;-<span class="st"> </span>SpecimenClient<span class="op">$</span><span class="kw">new</span>()</a></code></pre></div>
<p>In total, there are <a href="https://en.wikipedia.org/wiki/Shark">eight extant shark orders</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">shark_orders &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Carcharhiniformes"</span>,</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">                  <span class="st">"Heterodontiformes"</span>,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                  <span class="st">"Hexanchiformes"</span>,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                  <span class="st">"Lamniformes"</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">                  <span class="st">"Orectolobiformes"</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">                  <span class="st">"Pristiophoriformes"</span>,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">                  <span class="st">"Squaliformes"</span>,</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">                  <span class="st">"Squatiniformes"</span>)</a></code></pre></div>
<p>We can then formulate a query condition for specimens that are identified in one of these orders using the operator <code>IN</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">qc &lt;-<span class="st"> </span>QueryCondition<span class="op">$</span><span class="kw">new</span>(<span class="dt">field=</span><span class="st">"identifications.defaultClassification.order"</span>, <span class="dt">operator=</span><span class="st">"IN"</span>, <span class="dt">value=</span>shark_orders)</a></code></pre></div>
<p>For many specimen, chronological information is available in the fiels <code>gatheringEvent.chronoStratigraphy.youngChronoName</code> and <code>gatheringEvent.chronoStratigraphy.oldChronoName</code> which represent the upper- and lower time bounds, respectively. Below, we will formulate a <code>QueryCondition</code> that requires either one of these fields to be non-empty:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">## formulate query conditions for fields to be non-empty</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">qc2 &lt;-<span class="st"> </span>QueryCondition<span class="op">$</span><span class="kw">new</span>(<span class="dt">field=</span><span class="st">"gatheringEvent.chronoStratigraphy.youngChronoName"</span>, <span class="dt">operator=</span><span class="st">"NOT_EQUALS"</span>, <span class="dt">value=</span><span class="st">""</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">qc3 &lt;-<span class="st"> </span>QueryCondition<span class="op">$</span><span class="kw">new</span>(<span class="dt">field=</span><span class="st">"gatheringEvent.chronoStratigraphy.oldChronoName"</span>, <span class="dt">operator=</span><span class="st">"NOT_EQUALS"</span>, <span class="dt">value=</span><span class="st">""</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">## join qc2 and qc3 with operator OR</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">qc2<span class="op">$</span>or &lt;-<span class="st"> </span><span class="kw">list</span>(qc3)</a></code></pre></div>
<p>Now we can do the query:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">## instantiate QuerySpec, give size</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">qs &lt;-<span class="st"> </span>QuerySpec<span class="op">$</span><span class="kw">new</span>(<span class="dt">conditions=</span><span class="kw">list</span>(qc, qc3), <span class="dt">size=</span><span class="dv">5000</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">res &lt;-<span class="st"> </span>sc<span class="op">$</span><span class="kw">query</span>(<span class="dt">querySpec =</span> qs)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">## how many hits?</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">res<span class="op">$</span>content<span class="op">$</span>totalSize</a></code></pre></div>
<pre><code>## [1] 4009</code></pre>
<div id="exploring-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-the-data" class="anchor"></a>Exploring the data</h2>
<p>Now we can explore the data a bit:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">## load all specimens</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">specimens &lt;-<span class="st"> </span><span class="kw">lapply</span>(res<span class="op">$</span>content<span class="op">$</span>resultSet, <span class="cf">function</span>(x)x<span class="op">$</span>item)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">## whats in youngCronoName and oldChronoName?</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw">unique</span>(<span class="kw">unlist</span>(<span class="kw">lapply</span>(specimens, <span class="cf">function</span>(x)x<span class="op">$</span>gatheringEvent<span class="op">$</span>chronoStratigraphy[[<span class="dv">1</span>]]<span class="op">$</span>youngChronoName)))</a></code></pre></div>
<pre><code>##  [1] "Miocene"        "Pliocene"       "Upper Miocene"  "Pleistocene"   
##  [5] "Oligocene"      "Cretaceous"     "Chattian"       "Middle Miocene"
##  [9] "Paleocene"      "Lower Miocene"  "Maastrichtian"  "Pliocene?"</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">unique</span>(<span class="kw">unlist</span>(<span class="kw">lapply</span>(specimens, <span class="cf">function</span>(x)x<span class="op">$</span>gatheringEvent<span class="op">$</span>chronoStratigraphy[[<span class="dv">1</span>]]<span class="op">$</span>oldChronoName)))</a></code></pre></div>
<pre><code>##  [1] "Neogene"                                          
##  [2] "Middle Miocene"                                   
##  [3] "Middle Eocene"                                    
##  [4] "Mioceen"                                          
##  [5] "Oligocene"                                        
##  [6] "Miocene"                                          
##  [7] "Lower Miocene"                                    
##  [8] "Rupelian"                                         
##  [9] "Unspecified age"                                  
## [10] "Ypresian"                                         
## [11] "Recent"                                           
## [12] "Upper Miocene"                                    
## [13] "Eocene"                                           
## [14] "Pleistocene"                                      
## [15] "Unindentified Age"                                
## [16] "Pliocene"                                         
## [17] "B.Mioceen"                                        
## [18] "Cretaceous"                                       
## [19] "Priabonian"                                       
## [20] "Middle Pliocene"                                  
## [21] "Onderste Rupelien"                                
## [22] "Kwartaire afzetting op zanden van Grimmertingen"  
## [23] "Early Miocene"                                    
## [24] "Upper Eocene"                                     
## [25] "Oligoceen, Rupelien"                              
## [26] "Paleocene"                                        
## [27] "Tertiair"                                         
## [28] "M.mioceen"                                        
## [29] "Onder-Plioceen"                                   
## [30] "Mioceen?"                                         
## [31] "Lower Miocene?"                                   
## [32] "Maastrichtian"                                    
## [33] "Recent?"                                          
## [34] "A. karsteni - Niso sp. Ass. Zone"                 
## [35] "Oligoceen"                                        
## [36] "Plio-Pleistocene?"                                
## [37] "Lower Rupelian"                                   
## [38] "Plio-Pleistoceen"                                 
## [39] "Unindentified A"                                  
## [40] "Cenomanian"                                       
## [41] "Unspecified Age"                                  
## [42] "? Kwartaire afzetting op zanden van Grimmertingen"
## [43] "M.Miocen"                                         
## [44] "Pliocene?"                                        
## [45] "Middle Miocen"</code></pre>
<p><strong>Caution</strong>: As you see above, there can be more than one chronoStratigraphy assigned with a specimen. Check how many we have per specimen:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">unique</span>(<span class="kw">sapply</span>(res<span class="op">$</span>content<span class="op">$</span>resultSet, <span class="cf">function</span>(x)<span class="kw">length</span>(x<span class="op">$</span>item<span class="op">$</span>gatheringEvent<span class="op">$</span>chronoStratigraphy)))</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Ok, each <code>gatheringEvent</code> in each <code>Specimen</code> has only one <code>chronoStratigraphy</code>. We thus do not miss data by taking the first one (<code>chronoStratigraphy[[1]]</code>).</p>
<p>Let’s further expleore the data. To see what part of the animals were preserved, we can look into the field <code>kindOfUnit</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">table</span>(<span class="kw">sapply</span>(specimens, <span class="st">`</span><span class="dt">[[</span><span class="st">`</span>, <span class="st">"kindOfUnit"</span>))</a></code></pre></div>
<pre><code>## 
## AnimalPart      tooth   vertebra 
##          2       4006          1</code></pre>
<p>Almost all of them are teeth.</p>
</div>
<div id="getting-absolute-ages" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-absolute-ages" class="anchor"></a>Getting absolute ages</h2>
<p>The type of chronostratigraphic data (as shown above) is given in divisions on the geological time scale, e.g. <em>Miocene</em>. These strings can refer to <em>eons</em>, <em>eras</em>, <em>periods</em>, <em>epochs</em> and <em>ages</em>. In order to translate this into absolute ages, we will use the API of the <a href="http://earthlifeconsortium.org/">Earth Life Consortium</a>. This is possible using the <em>conventience function</em> <code>get_age</code>. For example</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">## get the upper chrono name for the first specimen</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">name &lt;-<span class="st"> </span>specimens[[<span class="dv">1</span>]]<span class="op">$</span>gatheringEvent<span class="op">$</span>chronoStratigraphy[[<span class="dv">1</span>]]<span class="op">$</span>oldChronoNam</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">name</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">## get the lower and upper bounds for this division</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw">geo_age</span>(name)</a></code></pre></div>
<pre><code>## data frame with 0 columns and 2 rows</code></pre>
<p>We can now make a table with all interesting data, below this is done for the first 50 specimen objetcs:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">## Get genus, species and chrono information from specimen records</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">do.call</span>(rbind, <span class="kw">lapply</span>(specimens[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>], <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">    genus &lt;-<span class="st"> </span>x<span class="op">$</span>identifications[[<span class="dv">1</span>]]<span class="op">$</span>defaultClassification<span class="op">$</span>genus</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">    <span class="cf">if</span> (<span class="kw">is.null</span>(genus)) genus &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    specificEpithet &lt;-<span class="st"> </span>x<span class="op">$</span>identifications[[<span class="dv">1</span>]]<span class="op">$</span>defaultClassification<span class="op">$</span>specificEpithet</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">    <span class="cf">if</span> (<span class="kw">is.null</span>(specificEpithet)) specificEpithet &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7">    youngChronoName &lt;-<span class="st"> </span>x<span class="op">$</span>gatheringEvent<span class="op">$</span>chronoStratigraphy[[<span class="dv">1</span>]]<span class="op">$</span>youngChronoName</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">    <span class="cf">if</span> (<span class="kw">is.null</span>(youngChronoName)) youngChronoName &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9">    oldChronoName &lt;-<span class="st"> </span>x<span class="op">$</span>gatheringEvent<span class="op">$</span>chronoStratigraphy[[<span class="dv">1</span>]]<span class="op">$</span>oldChronoName</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">    <span class="cf">if</span> (<span class="kw">is.null</span>(oldChronoName)) oldChronoName &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11">    <span class="kw">c</span>(<span class="dt">genus=</span>genus, <span class="dt">specificEpithet=</span>specificEpithet,</a>
<a class="sourceLine" id="cb19-12" data-line-number="12">      <span class="dt">youngChronoName=</span>youngChronoName, <span class="dt">oldChronoName=</span>oldChronoName)</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">})))</a>
<a class="sourceLine" id="cb19-14" data-line-number="14"></a>
<a class="sourceLine" id="cb19-15" data-line-number="15">## Get absolute ages from earth life consortium</a>
<a class="sourceLine" id="cb19-16" data-line-number="16">times &lt;-<span class="st"> </span><span class="kw">geo_age</span>(<span class="kw">unique</span>(<span class="kw">c</span>(<span class="kw">as.character</span>(data<span class="op">$</span>youngChronoName), <span class="kw">as.character</span>(data<span class="op">$</span>oldChronoName))))</a></code></pre></div>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Mioceen" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Unspecified age" from earthlifeconsortium.org</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">## add upper and lower bounds to ages</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">data<span class="op">$</span>young_age &lt;-<span class="st"> </span><span class="kw">sapply</span>(data<span class="op">$</span>youngChronoName, <span class="cf">function</span>(x)<span class="kw">ifelse</span>(<span class="kw">is.na</span>(x), <span class="ot">NA</span>, <span class="kw">unlist</span>(times[<span class="st">'late_age'</span>, <span class="kw">as.character</span>(x)])))</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">data<span class="op">$</span>old_age &lt;-<span class="st"> </span><span class="kw">sapply</span>(data<span class="op">$</span>oldChronoName, <span class="cf">function</span>(x)<span class="kw">ifelse</span>(<span class="kw">is.na</span>(x), <span class="ot">NA</span>, <span class="kw">unlist</span>(times[<span class="st">'early_age'</span>, <span class="kw">as.character</span>(x)])))</a>
<a class="sourceLine" id="cb22-4" data-line-number="4"></a>
<a class="sourceLine" id="cb22-5" data-line-number="5">data</a></code></pre></div>
<pre><code>##               genus specificEpithet youngChronoName   oldChronoName
## 1     Ginglymostoma             sp.            &lt;NA&gt;         Neogene
## 2  Megascyliorhinus      sp. indet.            &lt;NA&gt;  Middle Miocene
## 3      Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4      Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 5      Eostegostoma         angusta            &lt;NA&gt;   Middle Eocene
## 6   Palaeorhincodon           wardi            &lt;NA&gt;   Middle Eocene
## 7   Palaeorhincodon           wardi            &lt;NA&gt;   Middle Eocene
## 8     Pristiophorus             sp.            &lt;NA&gt;         Mioceen
## 9     Pristiophorus     rupeliensis            &lt;NA&gt;       Oligocene
## 10    Pristiophorus     rupeliensis            &lt;NA&gt;       Oligocene
## 11    Pristiophorus      schroederi         Miocene         Miocene
## 12    Chiloscyllium         minutum            &lt;NA&gt;            &lt;NA&gt;
## 13        Notidanus     primigenius            &lt;NA&gt;   Lower Miocene
## 14     Notorhynchus     primigenius            &lt;NA&gt;         Mioceen
## 15        Hexanchus     primigenius         Miocene         Miocene
## 16    Pristiophorus      schroederi        Pliocene         Miocene
## 17     Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 18     Heterodontus        vincenti            &lt;NA&gt;   Middle Eocene
## 19     Heterodontus        vincenti            &lt;NA&gt;   Middle Eocene
## 20     Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 21     Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 22    Pristiophorus      schroederi        Pliocene            &lt;NA&gt;
## 23    Pristiophorus             sp.            &lt;NA&gt;         Mioceen
## 24    Pristiophorus      schroederi        Pliocene         Miocene
## 25    Pristiophorus      schroederi        Pliocene         Miocene
## 26    Pristiophorus      schroederi        Pliocene         Miocene
## 27    Pristiophorus     rupeliensis            &lt;NA&gt;       Oligocene
## 28   Pristiophorus?      schroederi        Pliocene         Miocene
## 29   Pristiophorus?            &lt;NA&gt;         Miocene         Miocene
## 30    Pristiophorus     rupeliensis            &lt;NA&gt;        Rupelian
## 31    Pristiophorus     rupeliensis            &lt;NA&gt;       Oligocene
## 32    Pristiophorus     rupeliensis            &lt;NA&gt;       Oligocene
## 33    Pristiophorus             sp.            &lt;NA&gt;         Mioceen
## 34    Pristiophorus     rupeliensis            &lt;NA&gt;       Oligocene
## 35    Pristiophorus     rupeliensis            &lt;NA&gt;       Oligocene
## 36    Pristiophorus      schroederi        Pliocene         Miocene
## 37     Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 38     Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 39     Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 40    Pristiophorus             sp.            &lt;NA&gt;         Miocene
## 41    Pristiophorus     rupeliensis            &lt;NA&gt;       Oligocene
## 42    Pristiophorus             sp.            &lt;NA&gt;         Mioceen
## 43     Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 44     Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 45     Heterodontus            &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 46         Squatina      sp. indet.            &lt;NA&gt;  Middle Miocene
## 47         Squatina            &lt;NA&gt;            &lt;NA&gt;         Miocene
## 48         Squatina           prima            &lt;NA&gt; Unspecified age
## 49         Squatina         biforis            &lt;NA&gt;  Middle Miocene
## 50         Squatina             sp.        Pliocene            &lt;NA&gt;
##    young_age old_age
## 1         NA   23.03
## 2         NA   15.97
## 3         NA      NA
## 4         NA      NA
## 5         NA   48.60
## 6         NA   48.60
## 7         NA   48.60
## 8         NA      NA
## 9         NA   33.90
## 10        NA   33.90
## 11      5.33   23.03
## 12        NA      NA
## 13        NA   23.03
## 14        NA      NA
## 15      5.33   23.03
## 16      2.59   23.03
## 17        NA      NA
## 18        NA   48.60
## 19        NA   48.60
## 20        NA      NA
## 21        NA      NA
## 22      2.59      NA
## 23        NA      NA
## 24      2.59   23.03
## 25      2.59   23.03
## 26      2.59   23.03
## 27        NA   33.90
## 28      2.59   23.03
## 29      5.33   23.03
## 30        NA   33.90
## 31        NA   33.90
## 32        NA   33.90
## 33        NA      NA
## 34        NA   33.90
## 35        NA   33.90
## 36      2.59   23.03
## 37        NA      NA
## 38        NA      NA
## 39        NA      NA
## 40        NA   23.03
## 41        NA   33.90
## 42        NA      NA
## 43        NA      NA
## 44        NA      NA
## 45        NA      NA
## 46        NA   15.97
## 47        NA   23.03
## 48        NA      NA
## 49        NA   15.97
## 50      2.59      NA</code></pre>
</div>
</div>
<div id="calibrating-the-phylogeny" class="section level1">
<h1 class="hasAnchor">
<a href="#calibrating-the-phylogeny" class="anchor"></a>Calibrating the phylogeny</h1>
<p>Depending on the data, calibration points could be chosen on different taxonomic levels; If there are sufficient specimen determined at species level, one could use the upper- and lower bounds above. It is also possible to average upper- and lower values for a higher taxonomic group, such as genus or family. Since this requires some data cleaning, such as dealing with duplicates, missing data, etc, <code>nbaR</code> offers the function <code>chronos_calib</code> which takes a set of specimen object, and a tree and averages the data for a user-defined taxonomic group and returns a calibration table that can be directly used as input for the function <code>chronos</code> from the package <code>ape</code>. The function also determines the node which will be calibrated in the phylogenetic tree.</p>
<p>The shark phylogeny comes with the package and can be parsed using the package <code>ape</code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">library</span>(ape)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"></a>
<a class="sourceLine" id="cb24-3" data-line-number="3">## read data</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="st">'shark_tree.nex'</span>, <span class="dt">package=</span><span class="st">'nbaR'</span>)</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">tree &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ape/topics/read.nexus">read.nexus</a></span>(path)</a>
<a class="sourceLine" id="cb24-6" data-line-number="6"></a>
<a class="sourceLine" id="cb24-7" data-line-number="7">## plot the tree</a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="kw">plot</span>(tree, <span class="dt">cex=</span><span class="fl">0.3</span>)</a></code></pre></div>
<p><img src="sharks_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Now we use <code>chronos_calib</code> to get the table at the genus level. <code>chronos_calib</code> also selects the nodes in the tree that will be calibrated. This is done by selecting the most recent common ancestor (mrca) of the species for which the data are averaged.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">## make calibration table on genus level</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">calibration_table &lt;-<span class="st"> </span><span class="kw">chronos_calib</span>(specimens, tree, <span class="st">"genus"</span>)</a></code></pre></div>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Pliocene?" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Mioceen" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Unspecified age" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Recent" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Unindentified Age" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "B.Mioceen" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit "Middle
## Pliocene" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Onderste Rupelien" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in value[[3L]](cond): Timeout reached while retreiving values
## for geo unit "Kwartaire afzetting op zanden van Grimmertingen" from
## earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo
## unit "Kwartaire afzetting op zanden van Grimmertingen" from
## earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Oligoceen, Rupelien" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Tertiair" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "M.mioceen" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit "Onder-
## Plioceen" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Mioceen?" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit "Lower
## Miocene?" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Recent?" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in value[[3L]](cond): Timeout reached while retreiving values for
## geo unit "A. karsteni - Niso sp. Ass. Zone" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit "A.
## karsteni - Niso sp. Ass. Zone" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Oligoceen" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit "Plio-
## Pleistocene?" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit "Lower
## Rupelian" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit "Plio-
## Pleistoceen" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Unindentified A" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "Unspecified Age" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in value[[3L]](cond): Timeout reached while retreiving values
## for geo unit "? Kwartaire afzetting op zanden van Grimmertingen" from
## earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo
## unit "? Kwartaire afzetting op zanden van Grimmertingen" from
## earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit
## "M.Miocen" from earthlifeconsortium.org</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retreive values for geo unit "Middle
## Miocen" from earthlifeconsortium.org</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">calibration_table</a></code></pre></div>
<pre><code>##    node   age.min  age.max soft.bounds         taxon
## 1   432  2.635714 21.35846       FALSE  Carcharhinus
## 2   364  0.870000 25.12714       FALSE        Galeus
## 3   311 66.000000 83.20000       FALSE  Heterodontus
## 4   243  5.444545 21.84214       FALSE     Hexanchus
## 5   320  4.745833 16.46489       FALSE        Isurus
## 6   318 28.984615 49.32840       FALSE         Lamna
## 7   245  3.503333 26.13571       FALSE Pristiophorus
## 8   346  3.960000 30.67263       FALSE  Scyliorhinus
## 9   428  0.010000 20.20600       FALSE       Sphyrna
## 10  297  5.708182 30.13364       FALSE       Squalus
## 11  237 16.384000 30.11038       FALSE      Squatina</code></pre>
<p><strong>Note</strong>: This function can produce many warnings, a worning is emitted whenever, for some geological division, no data can be obtained from the earth life consortium. This can be due to misspellings or words in foreign languages.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">## print the warnings</a>
<a class="sourceLine" id="cb57-2" data-line-number="2"><span class="kw">warnings</span>()</a></code></pre></div>
<pre><code>## NULL</code></pre>
<p><strong>Note</strong>: It is essential to thoroughly evaluate the calibration table! In this example, for example, the genus <em>Squatina</em> is non-monophyletic and one species is placed somewhere else in the tree. Calibrating the most recent common ancestor node for this genus can therefore result in errenous results or in errors using the calibration routine. We will therefore remove the calibration points for genus <em>Squatina</em> before calibration:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">## clean up: one reogue taxon in genus "Squatina"! Skip this genus</a>
<a class="sourceLine" id="cb59-2" data-line-number="2">calibration_table &lt;-<span class="st"> </span>calibration_table[calibration_table<span class="op">$</span>taxon <span class="op">!=</span><span class="st"> "Squatina"</span>,]</a>
<a class="sourceLine" id="cb59-3" data-line-number="3"></a>
<a class="sourceLine" id="cb59-4" data-line-number="4">## run ape's chronos</a>
<a class="sourceLine" id="cb59-5" data-line-number="5">chronogram &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ape/topics/chronos">chronos</a></span>(tree, <span class="dt">calibration=</span>calibration_table)</a>
<a class="sourceLine" id="cb59-6" data-line-number="6"></a>
<a class="sourceLine" id="cb59-7" data-line-number="7">## plot tree with time axis</a>
<a class="sourceLine" id="cb59-8" data-line-number="8"><span class="kw">plot</span>(chronogram, <span class="dt">cex=</span><span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb59-9" data-line-number="9"><span class="kw"><a href="http://www.rdocumentation.org/packages/ape/topics/axisPhylo">axisPhylo</a></span>()</a>
<a class="sourceLine" id="cb59-10" data-line-number="10"></a>
<a class="sourceLine" id="cb59-11" data-line-number="11">## label the mrcas that were used as calibration points</a>
<a class="sourceLine" id="cb59-12" data-line-number="12"><span class="kw"><a href="http://www.rdocumentation.org/packages/ape/topics/nodelabels">nodelabels</a></span>(calibration_table<span class="op">$</span>taxon, calibration_table<span class="op">$</span>node, <span class="dt">frame=</span><span class="st">'none'</span>, <span class="dt">pch=</span><span class="st">'x'</span>, <span class="dt">cex.tex=</span><span class="fl">0.6</span>)</a></code></pre></div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-VELEZZUAZO2011207">
<p>Vélez-Zuazo, Ximena, and Ingi Agnarsson. 2011. “Shark Tales: A Molecular Species-Level Phylogeny of Sharks (Selachimorpha, Chondrichthyes).” <em>Molecular Phylogenetics and Evolution</em> 58 (2): 207–17. <a href="https://doi.org/https://doi.org/10.1016/j.ympev.2010.11.018" class="uri">https://doi.org/https://doi.org/10.1016/j.ympev.2010.11.018</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#background">Background</a><ul class="nav nav-pills nav-stacked">
<li><a href="#the-phylogeny">The phylogeny</a></li>
      </ul>
</li>
      <li>
<a href="#getting-chronological-data-with-nbar">Getting chronological data with nbaR</a><ul class="nav nav-pills nav-stacked">
<li><a href="#exploring-the-data">Exploring the data</a></li>
      <li><a href="#getting-absolute-ages">Getting absolute ages</a></li>
      </ul>
</li>
      <li><a href="#calibrating-the-phylogeny">Calibrating the phylogeny</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Hannes Hettling.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
