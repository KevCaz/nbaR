<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The oldest tomato specimen in the world • nbaR</title>
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js" integrity="sha256-hIvIxeqhGZF+VVeM55k0mJvWpQ6gTkWk3Emc+NmowYA=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The oldest tomato specimen in the world">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nbaR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/nbaR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sharks.html">Calibrating a molecular phylogeny of the sharks</a>
    </li>
    <li>
      <a href="../articles/tomato.html">The oldest tomato specimen in the world</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/naturalis/nbaR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>The oldest tomato specimen in the world</h1>
            
            <h4 class="date">Feb 18, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/naturalis/nbaR/blob/master/vignettes/tomato.Rmd"><code>vignettes/tomato.Rmd</code></a></small>
      <div class="hidden name"><code>tomato.Rmd</code></div>

    </div>

    
    
<div id="the-en-tibi-tomato-specimen" class="section level1">
<h1 class="hasAnchor">
<a href="#the-en-tibi-tomato-specimen" class="anchor"></a>The ‘En Tibi’ tomato specimen</h1>
<div id="using-the-specimenclient" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-specimenclient" class="anchor"></a>Using the SpecimenClient</h2>
<p>For the different data types in the NBA (Specimen, Taxon, Multimedia, Geo), there are respective client classes (<code>SpecimenClient</code>, <code>TaxonClient</code>, <code>MultimediaClient</code>, <code>GeoClient</code>). To retreive electronic specimen records, we instantiate a <code>SpecimenClient</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(nbaR)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">sc &lt;-<span class="st"> </span>SpecimenClient<span class="op">$</span><span class="kw">new</span>()</a></code></pre></div>
<p>To get an overview of what we can do with such a client, <code><a href="../reference/SpecimenClient.html">?SpecimenClient</a></code> will give us some description and list all the methods that are available for this client. To get an overview of what nbaR stores in a <code>Specimen</code> object, we could use the function <code>get_paths</code>, which lists everything that can be queried for a specimen:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">res &lt;-<span class="st"> </span>sc<span class="op">$</span><span class="kw">get_paths</span>()</a></code></pre></div>
<p>Note that client class methods (and other class members) are accessed with a <code>$</code>. The response from the taxon client is stored in <code>res</code>, an object of class <code>Response</code>. Have a look at <code><a href="../reference/Response.html">?Response</a></code> to see what this object contains. But how to get the data? It is in the field <code>content</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">res<span class="op">$</span>content</a></code></pre></div>
<pre><code>##   [1] "sourceSystem.code"                                                              
##   [2] "sourceSystem.name"                                                              
##   [3] "sourceSystemId"                                                                 
##   [4] "recordURI"                                                                      
##   [5] "unitID"                                                                         
##   [6] "unitGUID"                                                                       
##   [7] "collectorsFieldNumber"                                                          
##   [8] "assemblageID"                                                                   
##   [9] "sourceInstitutionID"                                                            
##  [10] "sourceID"                                                                       
##  [11] "previousSourceID"                                                               
##  [12] "owner"                                                                          
##  [13] "licenseType"                                                                    
##  [14] "license"                                                                        
##  [15] "recordBasis"                                                                    
##  [16] "kindOfUnit"                                                                     
##  [17] "collectionType"                                                                 
##  [18] "sex"                                                                            
##  [19] "phaseOrStage"                                                                   
##  [20] "title"                                                                          
##  [21] "notes"                                                                          
##  [22] "preparationType"                                                                
##  [23] "previousUnitsText"                                                              
##  [24] "numberOfSpecimen"                                                               
##  [25] "fromCaptivity"                                                                  
##  [26] "objectPublic"                                                                   
##  [27] "multiMediaPublic"                                                               
##  [28] "acquiredFrom.agentText"                                                         
##  [29] "gatheringEvent.projectTitle"                                                    
##  [30] "gatheringEvent.worldRegion"                                                     
##  [31] "gatheringEvent.continent"                                                       
##  [32] "gatheringEvent.country"                                                         
##  [33] "gatheringEvent.iso3166Code"                                                     
##  [34] "gatheringEvent.provinceState"                                                   
##  [35] "gatheringEvent.island"                                                          
##  [36] "gatheringEvent.locality"                                                        
##  [37] "gatheringEvent.city"                                                            
##  [38] "gatheringEvent.sublocality"                                                     
##  [39] "gatheringEvent.localityText"                                                    
##  [40] "gatheringEvent.dateTimeBegin"                                                   
##  [41] "gatheringEvent.dateTimeEnd"                                                     
##  [42] "gatheringEvent.dateText"                                                        
##  [43] "gatheringEvent.method"                                                          
##  [44] "gatheringEvent.altitude"                                                        
##  [45] "gatheringEvent.altitudeUnifOfMeasurement"                                       
##  [46] "gatheringEvent.behavior"                                                        
##  [47] "gatheringEvent.biotopeText"                                                     
##  [48] "gatheringEvent.depth"                                                           
##  [49] "gatheringEvent.depthUnitOfMeasurement"                                          
##  [50] "gatheringEvent.code"                                                            
##  [51] "gatheringEvent.establishmentMeans"                                              
##  [52] "gatheringEvent.gatheringPersons.agentText"                                      
##  [53] "gatheringEvent.gatheringPersons.fullName"                                       
##  [54] "gatheringEvent.gatheringPersons.organization.agentText"                         
##  [55] "gatheringEvent.gatheringPersons.organization.name"                              
##  [56] "gatheringEvent.gatheringOrganizations.agentText"                                
##  [57] "gatheringEvent.gatheringOrganizations.name"                                     
##  [58] "gatheringEvent.siteCoordinates.longitudeDecimal"                                
##  [59] "gatheringEvent.siteCoordinates.latitudeDecimal"                                 
##  [60] "gatheringEvent.siteCoordinates.gridCellSystem"                                  
##  [61] "gatheringEvent.siteCoordinates.gridLatitudeDecimal"                             
##  [62] "gatheringEvent.siteCoordinates.gridLongitudeDecimal"                            
##  [63] "gatheringEvent.siteCoordinates.gridCellCode"                                    
##  [64] "gatheringEvent.siteCoordinates.gridQualifier"                                   
##  [65] "gatheringEvent.siteCoordinates.coordinateErrorDistanceInMeters"                 
##  [66] "gatheringEvent.siteCoordinates.spatialDatum"                                    
##  [67] "gatheringEvent.siteCoordinates.geoShape"                                        
##  [68] "gatheringEvent.namedAreas.areaName"                                             
##  [69] "gatheringEvent.namedAreas.areaClass"                                            
##  [70] "gatheringEvent.associatedTaxa.name"                                             
##  [71] "gatheringEvent.associatedTaxa.relationType"                                     
##  [72] "gatheringEvent.chronoStratigraphy.youngRegionalSubstage"                        
##  [73] "gatheringEvent.chronoStratigraphy.youngRegionalStage"                           
##  [74] "gatheringEvent.chronoStratigraphy.youngRegionalSeries"                          
##  [75] "gatheringEvent.chronoStratigraphy.youngDatingQualifier"                         
##  [76] "gatheringEvent.chronoStratigraphy.youngInternSystem"                            
##  [77] "gatheringEvent.chronoStratigraphy.youngInternSubstage"                          
##  [78] "gatheringEvent.chronoStratigraphy.youngInternStage"                             
##  [79] "gatheringEvent.chronoStratigraphy.youngInternSeries"                            
##  [80] "gatheringEvent.chronoStratigraphy.youngInternErathem"                           
##  [81] "gatheringEvent.chronoStratigraphy.youngInternEonothem"                          
##  [82] "gatheringEvent.chronoStratigraphy.youngChronoName"                              
##  [83] "gatheringEvent.chronoStratigraphy.youngCertainty"                               
##  [84] "gatheringEvent.chronoStratigraphy.oldDatingQualifier"                           
##  [85] "gatheringEvent.chronoStratigraphy.chronoPreferredFlag"                          
##  [86] "gatheringEvent.chronoStratigraphy.oldRegionalSubstage"                          
##  [87] "gatheringEvent.chronoStratigraphy.oldRegionalStage"                             
##  [88] "gatheringEvent.chronoStratigraphy.oldRegionalSeries"                            
##  [89] "gatheringEvent.chronoStratigraphy.oldInternSystem"                              
##  [90] "gatheringEvent.chronoStratigraphy.oldInternSubstage"                            
##  [91] "gatheringEvent.chronoStratigraphy.oldInternStage"                               
##  [92] "gatheringEvent.chronoStratigraphy.oldInternSeries"                              
##  [93] "gatheringEvent.chronoStratigraphy.oldInternErathem"                             
##  [94] "gatheringEvent.chronoStratigraphy.oldInternEonothem"                            
##  [95] "gatheringEvent.chronoStratigraphy.oldChronoName"                                
##  [96] "gatheringEvent.chronoStratigraphy.chronoIdentifier"                             
##  [97] "gatheringEvent.chronoStratigraphy.oldCertainty"                                 
##  [98] "gatheringEvent.bioStratigraphy.youngBioDatingQualifier"                         
##  [99] "gatheringEvent.bioStratigraphy.youngBioName"                                    
## [100] "gatheringEvent.bioStratigraphy.youngFossilZone"                                 
## [101] "gatheringEvent.bioStratigraphy.youngFossilSubZone"                              
## [102] "gatheringEvent.bioStratigraphy.youngBioCertainty"                               
## [103] "gatheringEvent.bioStratigraphy.youngStratType"                                  
## [104] "gatheringEvent.bioStratigraphy.bioDatingQualifier"                              
## [105] "gatheringEvent.bioStratigraphy.bioPreferredFlag"                                
## [106] "gatheringEvent.bioStratigraphy.rangePosition"                                   
## [107] "gatheringEvent.bioStratigraphy.oldBioName"                                      
## [108] "gatheringEvent.bioStratigraphy.bioIdentifier"                                   
## [109] "gatheringEvent.bioStratigraphy.oldFossilzone"                                   
## [110] "gatheringEvent.bioStratigraphy.oldFossilSubzone"                                
## [111] "gatheringEvent.bioStratigraphy.oldBioCertainty"                                 
## [112] "gatheringEvent.bioStratigraphy.oldBioStratType"                                 
## [113] "gatheringEvent.lithoStratigraphy.qualifier"                                     
## [114] "gatheringEvent.lithoStratigraphy.preferredFlag"                                 
## [115] "gatheringEvent.lithoStratigraphy.member2"                                       
## [116] "gatheringEvent.lithoStratigraphy.member"                                        
## [117] "gatheringEvent.lithoStratigraphy.informalName2"                                 
## [118] "gatheringEvent.lithoStratigraphy.informalName"                                  
## [119] "gatheringEvent.lithoStratigraphy.importedName2"                                 
## [120] "gatheringEvent.lithoStratigraphy.importedName1"                                 
## [121] "gatheringEvent.lithoStratigraphy.lithoIdentifier"                               
## [122] "gatheringEvent.lithoStratigraphy.formation2"                                    
## [123] "gatheringEvent.lithoStratigraphy.formationGroup2"                               
## [124] "gatheringEvent.lithoStratigraphy.formationGroup"                                
## [125] "gatheringEvent.lithoStratigraphy.formation"                                     
## [126] "gatheringEvent.lithoStratigraphy.certainty2"                                    
## [127] "gatheringEvent.lithoStratigraphy.certainty"                                     
## [128] "gatheringEvent.lithoStratigraphy.bed2"                                          
## [129] "gatheringEvent.lithoStratigraphy.bed"                                           
## [130] "informationWithheld"                                                            
## [131] "dataGeneralizations"                                                            
## [132] "modified"                                                                       
## [133] "identifications.taxonRank"                                                      
## [134] "identifications.scientificName.fullScientificName"                              
## [135] "identifications.scientificName.taxonomicStatus"                                 
## [136] "identifications.scientificName.genusOrMonomial"                                 
## [137] "identifications.scientificName.subgenus"                                        
## [138] "identifications.scientificName.specificEpithet"                                 
## [139] "identifications.scientificName.infraspecificEpithet"                            
## [140] "identifications.scientificName.infraspecificMarker"                             
## [141] "identifications.scientificName.nameAddendum"                                    
## [142] "identifications.scientificName.authorshipVerbatim"                              
## [143] "identifications.scientificName.author"                                          
## [144] "identifications.scientificName.year"                                            
## [145] "identifications.scientificName.scientificNameGroup"                             
## [146] "identifications.scientificName.references.titleCitation"                        
## [147] "identifications.scientificName.references.citationDetail"                       
## [148] "identifications.scientificName.references.uri"                                  
## [149] "identifications.scientificName.references.author.agentText"                     
## [150] "identifications.scientificName.references.author.fullName"                      
## [151] "identifications.scientificName.references.author.organization.agentText"        
## [152] "identifications.scientificName.references.author.organization.name"             
## [153] "identifications.scientificName.references.publicationDate"                      
## [154] "identifications.scientificName.experts.agentText"                               
## [155] "identifications.scientificName.experts.fullName"                                
## [156] "identifications.scientificName.experts.organization.agentText"                  
## [157] "identifications.scientificName.experts.organization.name"                       
## [158] "identifications.typeStatus"                                                     
## [159] "identifications.dateIdentified"                                                 
## [160] "identifications.defaultClassification.kingdom"                                  
## [161] "identifications.defaultClassification.phylum"                                   
## [162] "identifications.defaultClassification.className"                                
## [163] "identifications.defaultClassification.order"                                    
## [164] "identifications.defaultClassification.superFamily"                              
## [165] "identifications.defaultClassification.family"                                   
## [166] "identifications.defaultClassification.genus"                                    
## [167] "identifications.defaultClassification.subgenus"                                 
## [168] "identifications.defaultClassification.specificEpithet"                          
## [169] "identifications.defaultClassification.infraspecificEpithet"                     
## [170] "identifications.defaultClassification.infraspecificRank"                        
## [171] "identifications.systemClassification.rank"                                      
## [172] "identifications.systemClassification.name"                                      
## [173] "identifications.vernacularNames.name"                                           
## [174] "identifications.vernacularNames.language"                                       
## [175] "identifications.vernacularNames.preferred"                                      
## [176] "identifications.vernacularNames.references.titleCitation"                       
## [177] "identifications.vernacularNames.references.citationDetail"                      
## [178] "identifications.vernacularNames.references.uri"                                 
## [179] "identifications.vernacularNames.references.author.agentText"                    
## [180] "identifications.vernacularNames.references.author.fullName"                     
## [181] "identifications.vernacularNames.references.author.organization.agentText"       
## [182] "identifications.vernacularNames.references.author.organization.name"            
## [183] "identifications.vernacularNames.references.publicationDate"                     
## [184] "identifications.vernacularNames.experts.agentText"                              
## [185] "identifications.vernacularNames.experts.fullName"                               
## [186] "identifications.vernacularNames.experts.organization.agentText"                 
## [187] "identifications.vernacularNames.experts.organization.name"                      
## [188] "identifications.identificationQualifiers"                                       
## [189] "identifications.identifiers.agentText"                                          
## [190] "identifications.taxonomicEnrichments.vernacularNames.name"                      
## [191] "identifications.taxonomicEnrichments.vernacularNames.language"                  
## [192] "identifications.taxonomicEnrichments.synonyms.fullScientificName"               
## [193] "identifications.taxonomicEnrichments.synonyms.taxonomicStatus"                  
## [194] "identifications.taxonomicEnrichments.synonyms.genusOrMonomial"                  
## [195] "identifications.taxonomicEnrichments.synonyms.subgenus"                         
## [196] "identifications.taxonomicEnrichments.synonyms.specificEpithet"                  
## [197] "identifications.taxonomicEnrichments.synonyms.infraspecificEpithet"             
## [198] "identifications.taxonomicEnrichments.synonyms.authorshipVerbatim"               
## [199] "identifications.taxonomicEnrichments.defaultClassification.kingdom"             
## [200] "identifications.taxonomicEnrichments.defaultClassification.phylum"              
## [201] "identifications.taxonomicEnrichments.defaultClassification.className"           
## [202] "identifications.taxonomicEnrichments.defaultClassification.order"               
## [203] "identifications.taxonomicEnrichments.defaultClassification.superFamily"         
## [204] "identifications.taxonomicEnrichments.defaultClassification.family"              
## [205] "identifications.taxonomicEnrichments.defaultClassification.genus"               
## [206] "identifications.taxonomicEnrichments.defaultClassification.subgenus"            
## [207] "identifications.taxonomicEnrichments.defaultClassification.specificEpithet"     
## [208] "identifications.taxonomicEnrichments.defaultClassification.infraspecificEpithet"
## [209] "identifications.taxonomicEnrichments.defaultClassification.infraspecificRank"   
## [210] "identifications.taxonomicEnrichments.sourceSystem.code"                         
## [211] "identifications.taxonomicEnrichments.taxonId"                                   
## [212] "identifications.preferred"                                                      
## [213] "identifications.verificationStatus"                                             
## [214] "identifications.rockType"                                                       
## [215] "identifications.associatedFossilAssemblage"                                     
## [216] "identifications.rockMineralUsage"                                               
## [217] "identifications.associatedMineralName"                                          
## [218] "identifications.remarks"                                                        
## [219] "associatedMultiMediaUris.accessUri"                                             
## [220] "associatedMultiMediaUris.format"                                                
## [221] "associatedMultiMediaUris.variant"                                               
## [222] "theme"</code></pre>
<p>Suppose that we do not know the scientific name of the tomato plant, there are two fields that store a vernacular name for a specimen:</p>
<ul>
<li><code>identifications.vernacularNames.name</code></li>
<li><code>identifications.taxonomicEnrichments.vernacularNames.name</code></li>
</ul>
<p>The first one is the vernacular name that is exactly equal to the one in the <em>source database</em>. Since often, a vernacular name is missing in the source database, a <em>taxonomic enrichment</em> is performed during the import of the data from the source database in which, using among others the <em>Catalogue of life</em>, species names are enriched with synonyms and vernacular names.</p>
</div>
<div id="simple-queries" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-queries" class="anchor"></a>Simple queries</h2>
<p>Let’s try the first field and query for all <code>Specimen</code> records with <code>identifications.vernacularNames.name</code> field matching the name <code>tomato</code>, we can use the client’s <code>query</code> function:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">res &lt;-</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span>sc<span class="op">$</span><span class="kw">query</span>(<span class="dt">queryParams =</span> <span class="kw">list</span>(<span class="dt">identifications.vernacularNames.name =</span> <span class="st">"tomato"</span>))</a></code></pre></div>
<p>Note that the <code>queryParams</code> arguments takes a list, so we could search for more criteria. How many hits do we got?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">res<span class="op">$</span>content<span class="op">$</span>totalSize</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>No hits, thus no record has the vernacular name equal to <code>tomato</code>. We therefore search in <code>identifications.taxonomicEnrichments.vernacularNames.name</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">res &lt;-</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span>sc<span class="op">$</span><span class="kw">query</span>(</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    <span class="dt">queryParams =</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">      <span class="kw">list</span>(<span class="dt">identifications.taxonomicEnrichments.vernacularNames.name =</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">             <span class="st">"tomato"</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co"># how many hits?</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">res<span class="op">$</span>content<span class="op">$</span>totalSize</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Again, no hits.</p>
</div>
<div id="more-complex-queries" class="section level2">
<h2 class="hasAnchor">
<a href="#more-complex-queries" class="anchor"></a>More complex queries</h2>
<p>Let’s try partial matching. For this, we have to make a more complicated query, involving <code>QuerySpec</code> and <code>QueryCondition</code> objects, which are very powerful for constructing complex and nested queries.</p>
<p>A <code>QueryCondition</code> can be specified as follows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">qc &lt;-</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span>QueryCondition<span class="op">$</span><span class="kw">new</span>(</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">    <span class="dt">field =</span> <span class="st">"identifications.taxonomicEnrichments.vernacularNames.name"</span>,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">    <span class="dt">operator =</span> <span class="st">"MATCHES"</span>,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    <span class="dt">value =</span> <span class="st">"tomato"</span>)</a></code></pre></div>
<p>Note that we use the operator <code>MATCHES</code> that does a partial instead of an exact match (which would be <code>EQUALS</code>).</p>
<p>From one or multiple <code>QueryConditions</code>, a <code>QuerySpec</code> can be created, and used as input for he <code>query</code> function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">qs &lt;-<span class="st"> </span>QuerySpec<span class="op">$</span><span class="kw">new</span>(<span class="dt">conditions=</span><span class="kw">list</span>(qc))</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># do the query with SpecimenClient</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">res &lt;-<span class="st"> </span>sc<span class="op">$</span><span class="kw">query</span>(<span class="dt">querySpec=</span>qs)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co"># how many hits?</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">res<span class="op">$</span>content<span class="op">$</span>totalSize</a></code></pre></div>
<pre><code>## [1] 380</code></pre>
<p>Finally, we have some hits. The content of the response of the <code>query</code> function is always of type <code>QueryResult</code> (see also <code><a href="../reference/QueryResult.html">?QueryResult</a></code>) which has the fields <code>totalSize</code> (as used above) and a <code>resultSet</code>, a list which stores the actual data. From the <code>resultSet</code>, a single <code>Specimen</code> object can be obtained as follows:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># retreive the first Specimen object</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">sp &lt;-<span class="st"> </span>res<span class="op">$</span>content<span class="op">$</span>resultSet[[<span class="dv">1</span>]]<span class="op">$</span>item</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co"># check if it is really a specimen</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">class</span>(sp)</a></code></pre></div>
<pre><code>## [1] "Specimen" "R6"</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># list fields and methods of the object</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">sp</a></code></pre></div>
<pre><code>## &lt;Specimen&gt;
##   Public:
##     acquiredFrom: Agent, R6
##     assemblageID: 4394584@BRAHMS
##     associatedMultiMediaUris: list
##     clone: function (deep = FALSE) 
##     collectionType: Botany
##     collectorsFieldNumber: Unknown  s.n. 
##     fromCaptivity: NULL
##     fromJSONString: function (SpecimenJson, typeMapping = NULL) 
##     fromList: function (SpecimenList, typeMapping = NULL) 
##     gatheringEvent: GatheringEvent, R6
##     id: L.1110630@BRAHMS
##     identifications: list
##     initialize: function (sourceSystem, sourceSystemId, recordURI, id, unitID, 
##     kindOfUnit: NULL
##     license: CC0 4.0
##     licenseType: Copyright
##     multiMediaPublic: NULL
##     notes: NULL
##     numberOfSpecimen: NULL
##     objectPublic: TRUE
##     owner: Naturalis Biodiversity Center
##     phaseOrStage: NULL
##     preparationType: NULL
##     previousSourceID: NULL
##     previousUnitsText: NULL
##     recordBasis: Microscopic slide: Anatomy
##     recordURI: NULL
##     sex: NULL
##     sourceID: Brahms
##     sourceInstitutionID: Naturalis Biodiversity Center
##     sourceSystem: SourceSystem, R6
##     sourceSystemId: L.1110630
##     theme: NULL
##     title: NULL
##     toJSONString: function (pretty = TRUE) 
##     toList: function () 
##     unitGUID: http://data.biodiversitydata.nl/naturalis/specimen/L.1110630
##     unitID: L.1110630</code></pre>
<p><strong>Note:</strong> By default, the NBA (and thus nbaR) returns the first 10 hits. To fetch more records, we need to specify this in the <code>QuerySpec</code> object.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># specify size in QuerySpec obejct</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">qs &lt;-<span class="st"> </span>QuerySpec<span class="op">$</span><span class="kw">new</span>(<span class="dt">conditions=</span><span class="kw">list</span>(qc), <span class="dt">size=</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co"># perform query</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">res &lt;-<span class="st"> </span>sc<span class="op">$</span><span class="kw">query</span>(<span class="dt">querySpec=</span>qs)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6"></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co"># do we have all records?</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8">res<span class="op">$</span>content<span class="op">$</span>totalSize <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(res<span class="op">$</span>content<span class="op">$</span>resultSet)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="sorting" class="section level2">
<h2 class="hasAnchor">
<a href="#sorting" class="anchor"></a>Sorting</h2>
<p>We now want to see which one is the oldest specimen. We could, of course do the sorting in R (e.g. <code>sort(unlist(lapply(res$content$resultSet, function(x)x$item$gatheringEvent$dateTimeBegin)))</code>), but there is also functionality to do this directly in the query. This can be done with objects of type <code><a href="../reference/SortField.html">?SortField</a></code>, which can take a path specifying on what to sort, and whether to sort ascending or descending. We will sort our results by the values of the field <code>gatheringEvent.dateTimeBegin</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># specify field to sort</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">sf &lt;-<span class="st"> </span>SortField<span class="op">$</span><span class="kw">new</span>(<span class="dt">path=</span><span class="st">"gatheringEvent.dateTimeBegin"</span>, <span class="dt">sortOrder=</span><span class="st">"asc"</span>)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co"># make querySpec using sortField</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5">qs &lt;-<span class="st"> </span>QuerySpec<span class="op">$</span><span class="kw">new</span>(<span class="dt">conditions=</span><span class="kw">list</span>(qc), <span class="dt">size=</span><span class="dv">1000</span>, <span class="dt">sortFields=</span><span class="kw">list</span>(sf))</a>
<a class="sourceLine" id="cb19-6" data-line-number="6"></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co"># do the query</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8">res &lt;-<span class="st"> </span>sc<span class="op">$</span><span class="kw">query</span>(<span class="dt">querySpec=</span>qs)</a></code></pre></div>
<p>Now, the first result should be the specimen with a gathering event the furthest in the past.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">sp &lt;-<span class="st"> </span>res<span class="op">$</span>content<span class="op">$</span>resultSet[[<span class="dv">1</span>]]<span class="op">$</span>item</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="co"># get date</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4">sp<span class="op">$</span>gatheringEvent<span class="op">$</span>dateTimeBegin</a></code></pre></div>
<pre><code>## [1] "1550-01-01T00:00:00+0000"</code></pre>
</div>
<div id="multimedia-content" class="section level2">
<h2 class="hasAnchor">
<a href="#multimedia-content" class="anchor"></a>Multimedia content</h2>
<p>Many specimens have associated multimedia content, such as photos or videos. To retrieve e.g. the URL of the first multimedia item of our specimen:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># get multimedia URL</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">url &lt;-<span class="st"> </span>sp<span class="op">$</span>associatedMultiMediaUris[[<span class="dv">1</span>]]<span class="op">$</span>accessUri</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">url</a></code></pre></div>
<pre><code>## [1] "http://medialib.naturalis.nl/file/id/L.2111092/format/large"</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co"># display image</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/include_graphics">include_graphics</a></span>(url)</a></code></pre></div>
<p><img src="http://medialib.naturalis.nl/file/id/L.2111092/format/large"><!-- --></p>
</div>
</div>
<div id="retrieving-specimen-records-with-latlong-coordinates" class="section level1">
<h1 class="hasAnchor">
<a href="#retrieving-specimen-records-with-latlong-coordinates" class="anchor"></a>Retrieving specimen records with lat/long coordinates</h1>
<p>Geo-referenced specimens are an invaluable resource for biogeographic analyses. The below example shows how to extract the tomato specimen (species <em>Solanum lycopersicum</em>) that are geo referenced. The coordinates, stored in the field <em>gatheringEvent.siteCoordinates</em> are then extracted and the locations are plotted on a world map.</p>
<p><strong>Note:</strong> When querying for records with non-empty values for a specific field, we use the operator <code>NOT_EQUALS</code> in combination with the value <code>NULL</code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># conditions for specimens for Solanum lycopersicum</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">qc &lt;-</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="st">  </span>QueryCondition<span class="op">$</span><span class="kw">new</span>(<span class="dt">field =</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4">                       <span class="st">'identifications.defaultClassification.genus'</span>,</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">                     <span class="dt">operator =</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">                       <span class="st">'EQUALS'</span>,</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">                     <span class="dt">value =</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8">                       <span class="st">'Solanum'</span>)</a>
<a class="sourceLine" id="cb25-9" data-line-number="9">qc2 &lt;-</a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="st">  </span>QueryCondition<span class="op">$</span><span class="kw">new</span>(<span class="dt">field =</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11">                       <span class="st">'identifications.defaultClassification.specificEpithet'</span>,</a>
<a class="sourceLine" id="cb25-12" data-line-number="12">                     <span class="dt">operator =</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13">                       <span class="st">'EQUALS'</span>,</a>
<a class="sourceLine" id="cb25-14" data-line-number="14">                     <span class="dt">value =</span> <span class="st">'lycopersicum'</span>)</a>
<a class="sourceLine" id="cb25-15" data-line-number="15"></a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="co"># coditions for lat/long coordinates to be present</span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17">qc3 &lt;-</a>
<a class="sourceLine" id="cb25-18" data-line-number="18"><span class="st">  </span>QueryCondition<span class="op">$</span><span class="kw">new</span>(<span class="dt">field =</span></a>
<a class="sourceLine" id="cb25-19" data-line-number="19">                       <span class="st">'gatheringEvent.siteCoordinates.longitudeDecimal'</span>,</a>
<a class="sourceLine" id="cb25-20" data-line-number="20">                     <span class="dt">operator =</span></a>
<a class="sourceLine" id="cb25-21" data-line-number="21">                       <span class="st">"NOT_EQUALS"</span>,</a>
<a class="sourceLine" id="cb25-22" data-line-number="22">                     <span class="dt">value =</span></a>
<a class="sourceLine" id="cb25-23" data-line-number="23">                       <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb25-24" data-line-number="24">qc4 &lt;-</a>
<a class="sourceLine" id="cb25-25" data-line-number="25"><span class="st">  </span>QueryCondition<span class="op">$</span><span class="kw">new</span>(<span class="dt">field =</span></a>
<a class="sourceLine" id="cb25-26" data-line-number="26">                       <span class="st">'gatheringEvent.siteCoordinates.latitudeDecimal'</span>,</a>
<a class="sourceLine" id="cb25-27" data-line-number="27">                     <span class="dt">operator =</span></a>
<a class="sourceLine" id="cb25-28" data-line-number="28">                       <span class="st">"NOT_EQUALS"</span>,</a>
<a class="sourceLine" id="cb25-29" data-line-number="29">                     <span class="dt">value =</span></a>
<a class="sourceLine" id="cb25-30" data-line-number="30">                       <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb25-31" data-line-number="31">qs &lt;-</a>
<a class="sourceLine" id="cb25-32" data-line-number="32"><span class="st">  </span>QuerySpec<span class="op">$</span><span class="kw">new</span>(<span class="dt">conditions =</span> <span class="kw">list</span>(qc, qc2, qc3, qc4), <span class="dt">size =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb25-33" data-line-number="33"></a>
<a class="sourceLine" id="cb25-34" data-line-number="34"><span class="co"># do query</span></a>
<a class="sourceLine" id="cb25-35" data-line-number="35">res &lt;-<span class="st"> </span>sc<span class="op">$</span><span class="kw">query</span>(<span class="dt">querySpec =</span> qs)</a>
<a class="sourceLine" id="cb25-36" data-line-number="36"></a>
<a class="sourceLine" id="cb25-37" data-line-number="37"><span class="co"># extract coordinates</span></a>
<a class="sourceLine" id="cb25-38" data-line-number="38">lat &lt;-</a>
<a class="sourceLine" id="cb25-39" data-line-number="39"><span class="st">  </span><span class="kw">sapply</span>(res<span class="op">$</span>content<span class="op">$</span>resultSet, <span class="cf">function</span>(x)</a>
<a class="sourceLine" id="cb25-40" data-line-number="40">    x<span class="op">$</span>item<span class="op">$</span>gatheringEvent<span class="op">$</span>siteCoordinates[[<span class="dv">1</span>]]<span class="op">$</span>latitudeDecimal)</a>
<a class="sourceLine" id="cb25-41" data-line-number="41">long &lt;-</a>
<a class="sourceLine" id="cb25-42" data-line-number="42"><span class="st">  </span><span class="kw">sapply</span>(res<span class="op">$</span>content<span class="op">$</span>resultSet, <span class="cf">function</span>(x)</a>
<a class="sourceLine" id="cb25-43" data-line-number="43">    x<span class="op">$</span>item<span class="op">$</span>gatheringEvent<span class="op">$</span>siteCoordinates[[<span class="dv">1</span>]]<span class="op">$</span>longitudeDecimal)</a>
<a class="sourceLine" id="cb25-44" data-line-number="44"></a>
<a class="sourceLine" id="cb25-45" data-line-number="45"><span class="co">#plot on world map</span></a>
<a class="sourceLine" id="cb25-46" data-line-number="46"><span class="kw">library</span>(<span class="st">'maps'</span>)</a>
<a class="sourceLine" id="cb25-47" data-line-number="47"><span class="kw"><a href="http://www.rdocumentation.org/packages/maps/topics/map">map</a></span>(</a>
<a class="sourceLine" id="cb25-48" data-line-number="48">  <span class="st">"world"</span>,</a>
<a class="sourceLine" id="cb25-49" data-line-number="49">  <span class="dt">fill =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb25-50" data-line-number="50">  <span class="dt">col =</span> <span class="st">"white"</span>,</a>
<a class="sourceLine" id="cb25-51" data-line-number="51">  <span class="dt">bg =</span> <span class="st">"lightblue"</span>,</a>
<a class="sourceLine" id="cb25-52" data-line-number="52">  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">60</span>, <span class="dv">90</span>),</a>
<a class="sourceLine" id="cb25-53" data-line-number="53">  <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb25-54" data-line-number="54">)</a>
<a class="sourceLine" id="cb25-55" data-line-number="55"><span class="kw">points</span>(long, lat, <span class="dt">col =</span> <span class="st">'red'</span>, <span class="dt">pch =</span> <span class="dv">16</span>)</a></code></pre></div>
<p><img src="tomato_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#the-en-tibi-tomato-specimen">The ‘En Tibi’ tomato specimen</a><ul class="nav nav-pills nav-stacked">
<li><a href="#using-the-specimenclient">Using the SpecimenClient</a></li>
      <li><a href="#simple-queries">Simple queries</a></li>
      <li><a href="#more-complex-queries">More complex queries</a></li>
      <li><a href="#sorting">Sorting</a></li>
      <li><a href="#multimedia-content">Multimedia content</a></li>
      </ul>
</li>
      <li><a href="#retrieving-specimen-records-with-latlong-coordinates">Retrieving specimen records with lat/long coordinates</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Hannes Hettling, Rutger Vos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
